<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
  </head>

  <body>
    <div id="app">
      <table id="list-table">
        <thead>
          <th>Key</th>
          <th>Value</th>
        </thead>
        <tbody></tbody>
        <tfoot></tfoot>
      </table>
      <ul id="links"></ul>
    </div>

    <script>
      const createTr = (data, cellType = 'td') => {
        const row = document.createElement('tr')

        data.forEach((v) => {
          const cell = document.createElement(cellType)
          cell.appendChild(v)
          row.appendChild(cell)
        })

        return row
      }

      const linksList = document.getElementById('links')
      const table = document.getElementById('list-table')
      const tableBody = table.getElementsByTagName('tbody')[0]

      fetch(`./data.json?t=${Date.now()}`)
        .then((response) => response.ok && response.json())
        .then((json) => {
          if (!json) {
            return
          }

          json.links.forEach((record) => {
            const link = document.createElement('a')
            link.appendChild(document.createTextNode(record))
            link.href = record
            linksList.appendChild(link)
          })
          delete json.links

          Object.entries(json).forEach((record) => {
            record[0] = document.createTextNode(record[0])
            const link = document.createElement('a')
            link.appendChild(document.createTextNode(record[1]))
            link.href = record[1]
            record[1] = link
            tableBody.appendChild(createTr(record))
          })
        })
    </script>
  </body>
</html>
